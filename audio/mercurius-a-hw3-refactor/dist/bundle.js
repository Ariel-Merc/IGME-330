(()=>{"use strict";var e,t,o,n,a,s,i,r;!function(e){e[e.Gain=.5]="Gain",e[e.NumSamples=256]="NumSamples"}(e||(e={}));var c=function(e){o.src=e},l=function(){function e(e){var t=e.x,o=e.y,n=e.intensity;Object.assign(this,{x:t,y:o}),this.radius=5,this.alpha=1,this.growthTime=1+2*n,this.fadeTime=.01+.002*n}return e.prototype.update=function(){this.radius+=this.growthTime,this.alpha-=this.fadeTime},e.prototype.draw=function(e){e.beginPath(),e.strokeStyle="rgba(100, 200, 255, ".concat(this.alpha,")"),e.arc(this.x,this.y,this.radius,0,2*Math.PI),e.stroke(),e.closePath()},e.prototype.isDead=function(){return this.alpha<=0},e}();const u=l;var h,d,m,g,f,p=function(){function e(e){var t=e.image,o=e.radius;this.image=new Image,this.image.src=t,this.radius=o,this.theta=0,this.baseSpeed=.01,this.currentSpeed=this.baseSpeed}return e.prototype.update=function(e){var t=e[0]/255;this.currentSpeed=this.baseSpeed+.1*t,this.theta-=this.currentSpeed,this.theta<0&&(this.theta+=2*Math.PI)},e.prototype.draw=function(e,t,o){var n=t/2+this.radius*Math.cos(this.theta),a=o/2+this.radius*Math.sin(this.theta);e.save(),e.translate(n,a),e.rotate(this.theta),e.drawImage(this.image,-this.image.width/2,-this.image.height/2),e.restore()},e}(),v=0,w=0,y=[],S=new p({image:"../images/fish2.png",radius:-240}),b=new Image;b.src="../images/pond.png";var q,T=new Image;T.src="../images/lotus.png",function(e){e.Sound1="./media/The Forests of Gliese.mp3"}(q||(q={}));var M={showPond:!1,showBars:!1,showLillypad:!1,showRipples:!1,showNoise:!1,showInvert:!1,showEmboss:!1,showFish:!1,showWaves:!1,visualizationMode:"frequency"},k=!1,F=!1,I=function(){var l,u,p;console.log("Testing utils.getRandomColor() import: ".concat("rgba(".concat((p=function(){return 185*Math.random()+35})(),",").concat(p(),",").concat(p(),",1)"))),l=q.Sound1,u=window.AudioContext,t=new u,o=new Audio,c(l),n=t.createMediaElementSource(o),(i=t.createBiquadFilter()).type="highshelf",(r=t.createBiquadFilter()).type="lowshelf",(a=t.createAnalyser()).fftSize=e.NumSamples,(s=t.createGain()).gain.value=e.Gain,n.connect(i),i.connect(r),r.connect(a),a.connect(s),s.connect(t.destination);var v=document.querySelector("canvas");N(v),function(e,t){h=e.getContext("2d"),d=e.width,m=e.height,g=t,f=new Uint8Array(g.fftSize/2)}(v,a),P()},N=function(e){document.querySelector("#fs-button").onclick=function(t){var o;console.log("goFullscreen() called"),(o=e).requestFullscreen?o.requestFullscreen():o.mozRequestFullscreen?o.mozRequestFullscreen():o.mozRequestFullScreen?o.mozRequestFullScreen():o.webkitRequestFullscreen&&o.webkitRequestFullscreen()};var n=document.querySelector("#btn-play");n.onclick=function(e){console.log("audioCtx.state before = ".concat(t.state)),"suspended"==t.state&&t.resume(),console.log("audioCtx.state after = ".concat(t.state));var a=e.target;"no"==a.dataset.playing?(o.play(),n.innerHTML="⏸",a.dataset.playing="yes"):(o.pause(),n.innerHTML="▶",a.dataset.playing="no")};var a=document.querySelector("#slider-volume"),l=document.querySelector("#volume-label");a.oninput=function(e){!function(e){e=Number(e),s.gain.value=e}(e.target.value);var t=Number(e.target.value);l.innerHTML=Math.round(t/2*100).toString()},a.dispatchEvent(new Event("input")),document.querySelector("#select-track").onchange=function(e){var t=e.target;c(t.value),"yes"==n.dataset.playing&&(n.dispatchEvent(new MouseEvent("click")),n.innerHTML="▶")},document.querySelector("#cb-pond").onclick=function(){M.showPond=!M.showPond},document.querySelector("#cb-lillypad").onclick=function(){M.showLillypad?(M.showLillypad=!1,M.showBars=!1):(M.showLillypad=!0,M.showBars=!0)},document.querySelector("#cb-noise").onclick=function(){M.showNoise?M.showNoise=!1:M.showNoise=!0},document.querySelector("#cb-invert").onclick=function(){M.showInvert?M.showInvert=!1:M.showInvert=!0},document.querySelector("#cb-emboss").onclick=function(){M.showEmboss?M.showEmboss=!1:M.showEmboss=!0},document.querySelector("#cb-ripple").onclick=function(){M.showRipples?M.showRipples=!1:M.showRipples=!0},document.querySelector("#cb-fish").onclick=function(){M.showFish?M.showFish=!1:M.showFish=!0},document.querySelector("#select-viz").onchange=function(e){var t=e.target;M.visualizationMode=t.value};var u=document.querySelector("#cb-highshelf");u.checked=k,u.onchange=function(e){var o=e.target;!function(e){console.log("Highshelf toggle:",e),e?(i.frequency.setValueAtTime(1e3,t.currentTime),i.gain.setValueAtTime(25,t.currentTime)):i.gain.setValueAtTime(0,t.currentTime)}(k=o.checked)};var h=document.querySelector("#cb-lowshelf");h.checked=F,h.onchange=function(e){var o=e.target;!function(e){console.log("Lowshelf toggle:",e),e?(r.frequency.setValueAtTime(1e3,t.currentTime),r.gain.setValueAtTime(25,t.currentTime)):r.gain.setValueAtTime(0,t.currentTime)}(F=o.checked)}},P=function(){!function(e){if("waveform"===e.visualizationMode?g.getByteTimeDomainData(f):g.getByteFrequencyData(f),h.save(),h.fillStyle="black",h.globalAlpha=.1,h.fillRect(0,0,d,m),h.restore(),e.showPond&&(h.save(),h.drawImage(b,0,0,d,m),h.restore()),e.showWaves){var t=document.querySelector("#slider-wave"),o=Number(t.value);h.fillStyle="rgba(0, 150, 255, 0.8)",w+=2;for(var n=0;n<20;n++){var a=(w+40*n)%d,s=m/2+Math.sin(.05*(w+10*n))*o,i=f[n]/255,r=10;i>.55&&(r=10+10*i),h.beginPath(),h.arc(a,s,r,0,2*Math.PI),h.fill(),h.closePath()}}if(e.showBars){var c=Math.min(64,f.length);for(h.save(),h.strokeStyle="rgba(64, 176, 33, 0.8)",n=0;n<c;n++){var l=n/c*Math.PI*2,p=.5*f[n],q=70*-Math.cos(l),M=70*-Math.sin(l),k=-Math.cos(l)*(70+p),F=-Math.sin(l)*(70+p);h.save(),h.lineWidth=13,h.translate(d/2,m/2),h.rotate(v),h.beginPath(),h.moveTo(q,M),h.lineTo(k,F),h.stroke(),h.restore()}h.restore()}if(e.showFish&&(S.update(f),S.draw(h,d,m)),e.showLillypad){var I=f[0]/255;v+=.03*I,h.save(),h.translate(d/2,m/2),h.rotate(-v),h.drawImage(T,-80,-100,210,190),h.restore()}if(e.showRipples){for(n=0;n<f.length;n++){var N=document.querySelector("#slider-intensity");if(I=Number(N.value),f[n]/255>.001&&Math.random()<.001){var P=new u({x:Math.random()*d,y:Math.random()*m,intensity:I});y.push(P)}}for(n=y.length-1;n>=0;n--){var L=y[n];L.update(),L.draw(h),L.isDead()&&y.splice(n,1)}}var R=h.getImageData(0,0,d,m),E=R.data,A=E.length,H=R.width;for(n=0;n<A;n+=4)if(e.showNoise&&Math.random()<.05&&(E[n]=E[n+1]=E[n+2]=0,E[n]=100),e.showInvert){var z=E[n],x=E[n+1],B=E[n+2];E[n+1]=255-z,E[n+1]=255-x,E[n+2]=255-B}for(n=0;n<A;n++)if(e.showEmboss){if(n%4==3)continue;E[n]=127+2*E[n]-E[n+4]-E[n+4*H]}h.putImageData(R,0,0)}(M),setTimeout(P,1e3/60)};window.onload=function(){var e;console.log("window.onload called"),(e=new XMLHttpRequest).onload=function(e){var t=e.target;console.log("In onload - HTTP Status Code = ".concat(t.status));var o,n=t.responseText;try{o=JSON.parse(n)}catch(e){return void(document.querySelector("#output").innerHTML="json parse failed")}document.querySelector("h1").innerHTML=o.title;for(var a=document.querySelector("#select-track"),s=0,i=o.audioFiles;s<i.length;s++){var r=i[s],c=document.createElement("option");c.value=r.fileName,c.innerHTML=r.trackName,a.appendChild(c)}Object.assign(M,o.uiState)},e.onerror=function(e){var t=e.target;console.log("In onerror - HTTP Status Code = ".concat(t.status))},e.open("GET","data/av-data.json"),e.send(),I()}})();
//# sourceMappingURL=bundle.js.map