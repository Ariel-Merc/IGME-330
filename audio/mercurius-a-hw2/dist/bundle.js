(()=>{"use strict";var e,t,n,o,r,a,i,c=Object.freeze({gain:.5,numSamples:256}),s=(new Uint8Array(c.numSamples/2),function(e){t.src=e});function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function l(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,h(o.key),o)}}function h(e){var t=function(e){if("object"!=u(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=u(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==u(t)?t:t+""}var f=function(){return e=function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t,this.y=n,this.radius=5,this.alpha=1,this.growthTime=1+2*o,this.fadeTime=.01+.002*o},t=[{key:"update",value:function(){this.radius+=this.growthTime,this.alpha-=this.fadeTime}},{key:"draw",value:function(e,t){e.beginPath(),e.strokeStyle="rgba(100, 200, 255, ".concat(this.alpha,")"),e.arc(this.x,this.y,this.radius,0,2*Math.PI),e.stroke(),e.closePath()}},{key:"isDead",value:function(){return this.alpha<=0}}],t&&l(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function d(e){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d(e)}function m(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,y(o.key),o)}}function y(e){var t=function(e){if("object"!=d(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=d(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==d(t)?t:t+""}var v,p,g,w,b,S=function(){return e=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.image=new Image,this.image.src=t,this.radius=n,this.theta=0,this.baseSpeed=.01,this.currentSpeed=this.baseSpeed},t=[{key:"update",value:function(e){var t=e[0]/255;this.currentSpeed=this.baseSpeed+.1*t,this.theta-=this.currentSpeed,this.theta<0&&(this.theta+=2*Math.PI)}},{key:"draw",value:function(e,t,n){var o=t/2+this.radius*Math.cos(this.theta),r=n/2+this.radius*Math.sin(this.theta);e.save(),e.translate(o,r),e.rotate(this.theta),e.drawImage(this.image,-this.image.width/2,-this.image.height/2),e.restore()}}],t&&m(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}(),T=0,q=0,k=[],M=new S("../images/fish2.png",-240),P=new Image;P.src="../images/pond.png";var I=new Image;I.src="../images/lotus.png";var A={},F=!1,E=!1,j=Object.freeze({sound1:"./media/The Forests of Gliese.mp3"}),L=function(){var u,l,h;console.log("Testing utils.getRandomColor() import: ".concat("rgba(".concat((h=function(){return 185*Math.random()+35})(),",").concat(h(),",").concat(h(),",1)"))),u=j.sound1,l=window.AudioContext||window.webkitAudioContext,e=new l,t=new Audio,s(u),n=e.createMediaElementSource(t),(a=e.createBiquadFilter()).type="highshelf",(i=e.createBiquadFilter()).type="lowshelf",(o=e.createAnalyser()).fftSize=c.numSamples,(r=e.createGain()).gain.value=c.gain,n.connect(a),a.connect(i),i.connect(o),o.connect(r),r.connect(e.destination);var f=document.querySelector("canvas");R(f),function(e,t){v=e.getContext("2d"),p=e.width,g=e.height,w=t,b=new Uint8Array(w.fftSize/2)}(f,o),C()},R=function(n){document.querySelector("#fs-button").onclick=function(e){var t;console.log("goFullscreen() called"),(t=n).requestFullscreen?t.requestFullscreen():t.mozRequestFullscreen?t.mozRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()};var o=document.querySelector("#btn-play");o.onclick=function(n){console.log("audioCtx.state before = ".concat(e.state)),"suspended"==e.state&&e.resume(),console.log("audioCtx.state after = ".concat(e.state)),"no"==n.target.dataset.playing?(t.play(),o.innerHTML="⏸",n.target.dataset.playing="yes"):(t.pause(),o.innerHTML="▶",n.target.dataset.playing="no")};var c=document.querySelector("#slider-volume"),u=document.querySelector("#volume-label");c.oninput=function(e){var t;t=e.target.value,t=Number(t),r.gain.value=t,u.innerHTML=Math.round(e.target.value/2*100)},c.dispatchEvent(new Event("input")),document.querySelector("#select-track").onchange=function(e){s(e.target.value),"yes"==o.dataset.playing&&(o.dispatchEvent(new MouseEvent("click")),o.innerHTML="▶")},document.querySelector("#cb-pond").onclick=function(){A.showPond?A.showPond=!1:A.showPond=!0},document.querySelector("#cb-lillypad").onclick=function(){A.showLillypad?(A.showLillypad=!1,A.showBars=!1):(A.showLillypad=!0,A.showBars=!0)},document.querySelector("#cb-noise").onclick=function(){A.showNoise?A.showNoise=!1:A.showNoise=!0},document.querySelector("#cb-invert").onclick=function(){A.showInvert?A.showInvert=!1:A.showInvert=!0},document.querySelector("#cb-emboss").onclick=function(){A.showEmboss?A.showEmboss=!1:A.showEmboss=!0},document.querySelector("#cb-ripple").onclick=function(){A.showRipples?A.showRipples=!1:A.showRipples=!0},document.querySelector("#cb-fish").onclick=function(){A.showFish?A.showFish=!1:A.showFish=!0},document.querySelector("#select-viz").onchange=function(e){A.visualizationMode=e.target.value},document.querySelector("#cb-highshelf").checked=F,document.querySelector("#cb-highshelf").onchange=function(t){!function(t){console.log("Highshelf toggle:",t),t?(a.frequency.setValueAtTime(1e3,e.currentTime),a.gain.setValueAtTime(25,e.currentTime)):a.gain.setValueAtTime(0,e.currentTime)}(F=t.target.checked)},document.querySelector("#cb-lowshelf").checked=E,document.querySelector("#cb-lowshelf").onchange=function(t){!function(t){console.log("Lowshelf toggle:",t),t?(i.frequency.setValueAtTime(1e3,e.currentTime),i.gain.setValueAtTime(25,e.currentTime)):i.gain.setValueAtTime(0,e.currentTime)}(E=t.target.checked)}},C=function(){!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("waveform"===e.visualizationMode?w.getByteTimeDomainData(b):w.getByteFrequencyData(b),v.save(),v.fillStyle="black",v.globalAlpha=.1,v.fillRect(0,0,p,g),v.restore(),e.showPond&&(v.save(),v.drawImage(P,0,0,p,g),v.restore()),e.showWaves){var t=document.querySelector("#slider-wave").value;v.fillStyle="rgba(0, 150, 255, 0.8)",q+=2;for(var n=0;n<20;n++){var o=(q+40*n)%p,r=g/2+Math.sin(.05*(q+10*n))*t,a=b[n]/255,i=10;a>.55&&(i=10+10*a),v.beginPath(),v.arc(o,r,i,0,2*Math.PI),v.fill(),v.closePath()}}if(e.showBars){var c=Math.min(64,b.length);v.save(),v.strokeStyle="rgba(64, 176, 33, 0.8)";for(var s=0;s<c;s++){var u=s/c*Math.PI*2,l=.5*b[s],h=70*-Math.cos(u),d=70*-Math.sin(u),m=-Math.cos(u)*(70+l),y=-Math.sin(u)*(70+l);v.save(),v.lineWidth=13,v.translate(p/2,g/2),v.rotate(T),v.beginPath(),v.moveTo(h,d),v.lineTo(m,y),v.stroke(),v.restore()}v.restore()}if(e.showFish&&(M.update(b),M.draw(v,p,g)),e.showLillypad){var S=b[0]/255;T+=.03*S,v.save(),v.translate(p/2,g/2),v.rotate(-T),v.drawImage(I,-80,-100,210,190),v.restore()}if(e.showRipples){for(var A=0;A<b.length;A++){var F=document.querySelector("#slider-intensity").value;if(b[A]/255>.001&&Math.random()<.001){var E=new f(Math.random()*p,Math.random()*g,F);k.push(E)}}for(var j=k.length-1;j>=0;j--){var L=k[j];L.update(),L.draw(v),L.isDead()&&k.splice(j,1)}}for(var R=v.getImageData(0,0,p,g),C=R.data,z=C.length,H=R.width,x=0;x<z;x+=4)if(e.showNoise&&Math.random()<.05&&(C[x]=C[x+1]=C[x+2]=0,C[x]=100),e.showInvert){var N=C[x],O=C[x+1],B=C[x+2];C[x+1]=255-N,C[x+1]=255-O,C[x+2]=255-B}for(var D=0;D<z;D++)if(e.showEmboss){if(D%4==3)continue;C[D]=127+2*C[D]-C[D+4]-C[D+4*H]}v.putImageData(R,0,0)}(A),setTimeout(C,1e3/60)};function z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}window.onload=function(){var e;console.log("window.onload called"),(e=new XMLHttpRequest).onload=function(e){console.log("In onload - HTTP Status Code = ".concat(e.target.status));var t,n=e.target.responseText;try{t=JSON.parse(n)}catch(e){document.querySelector("#output").innerHTML="json parse failed"}document.querySelector("h1").innerHTML=t.title;var o,r=document.querySelector("#select-track"),a=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return z(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?z(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){c=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw a}}}}(t.audioFiles);try{for(a.s();!(o=a.n()).done;){var i=o.value,c=document.createElement("option");c.value=i.fileName,c.innerHTML=i.trackName,r.appendChild(c)}}catch(e){a.e(e)}finally{a.f()}for(var s in t.uiState)A[s]=t.uiState[s]},e.onerror=function(e){return console.log("In onerror - HTTP Status Code = ".concat(e.target.status))},e.open("GET","data/av-data.json"),e.send(),L()}})();